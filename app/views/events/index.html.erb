<div class="headline">
  <h1>イベントリスト</h1>
</div>

<div class="right">
  <%= link_to '新規イベント', new_event_path %>
</div>

<table class="tab_table">
  <thead>
    <tr>
      <th>主催者</th>
      <th>場所</th>
      <th>日付</th>
      <th>最大人数</th>
      <th>最低人数</th>
      <th colspan="3">操作</th>
      <th>参加</th>
    </tr>
  </thead>

  <tbody>
    <% @events.each do |event| %>
      <tr>
        <td><%= event.user_name %></td>
        <td><%= event.place %></td>
        <td><%= event.date.to_date %></td>
        <td><%= event.upper_num %></td>
        <td><%= event.lower_num %></td>
        <td><%= link_to '詳細', event %></td>
        <td>
          <% if event.refrigerators.first.user == current_user %>
            <%= link_to '変更', edit_event_path(event) %>
          <% end %>
        </td>
        <td><%= link_to '削除', event, method: :delete, data: { confirm: 'イベント、消しますよ？' } %></td>
        <td>
          <!--もしもイベ主催者でなかったら...by菅谷-->
          <% if event.refrigerators.first.user != current_user %>
            <% if @list = List.find_by(event_id: event.id, user_id: current_user.id, delete_flag: false) %>
              <%= link_to '[参加取消]', list_path(@list), method: :delete %>
            <% else %>
              <%= link_to '[参加]', lists_path(eid: event.id), method: :post %>
            <% end %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>